apply plugin: 'base'
apply plugin: 'groovy'
apply plugin: 'java'
apply plugin: 'application'

mkdir buildDir

wrapper {
    distributionType = Wrapper.DistributionType.ALL
    gradleVersion = "4.10.2"
}

task toa () {
  doLast {
    def toa = new ToaRestClient()
    println (toa.get("event/1819-FIM-Q4/matches"))
    println (toa.get("event/1819-FIM-Q4/matches/details"))

  }
}

task tba_event () {
  doLast {
    def tba = new TbaRestClient()
    def event =  new EventData ("2018mimil")
    def matchFactory = new TbaMatchDataFactory(event.eventKey)

    tba.getMatchKeys(event.eventKey).each { mk ->
      // get the match data from the internet
      def matchDataRaw = tba.getMatchData(mk)
      println (matchDataRaw.key)
      def matchDataBlue = matchFactory.getMatch (matchDataRaw.key)
      matchDataBlue.teams = matchDataRaw.alliances.blue.team_keys
      matchDataBlue.score = matchDataRaw.alliances.blue.score
      matchDataBlue.color = "blue"
      matchDataBlue.matchData = matchDataRaw.score_breakdown.blue
      event.addMatch(matchDataBlue)

      def matchDataRed = matchFactory.getMatch(matchDataRaw.key)
      matchDataRed.teams = matchDataRaw.alliances.red.team_keys
      matchDataRed.score = matchDataRaw.alliances.red.score
      matchDataRed.color = "red"
      matchDataRed.matchData = matchDataRaw.score_breakdown.red
      event.addMatch(matchDataRed)
    }
    event.write(buildDir.toString())
  }
}


task tba_test () {
  doLast {
    def tba = new TbaRestClient()
    println (tba.get ("event/2018mimil/matches"))
  }
}

task tba_listEvents () {
  doLast {
    def tba = new TbaRestClient()
    //println (tba.getDistricts())
    tba.getEvents("2014fim").each { event ->
      println (event.key)
    }
  }
}
